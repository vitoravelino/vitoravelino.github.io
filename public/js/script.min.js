(function(h){var d=this;$=this.jQuery,Modernizr=this.Modernizr;d.addEventListener("popstate",function(i){if(i.state){e.trigger("popstate",i.state.page);
}});var e={_listeners:{},on:function(j,l,i){var k;if(!j||!l){return this;}k=this._listeners[j]||(this._listeners[j]=[]);k.push([j,l,(i||l)]);return this;
},off:function(l,m){var k,j;if(!l||!m||!(k=this._listeners[l])){return this;}for(j=k.length;j>=0;j--){listener=k[j];if(m===listener[1]){m.slice(j,1);}}return this;
},trigger:function(n){var l,o,p,j,m,k;if(!n||!(l=this._listeners[n])){return this;}j=[];for(k=1,m=arguments.length;k<m;k++){j.push(arguments[k]);}for(k=l.length-1;
k>=0;k--){o=l[k];p=o[1];p.apply(o[2]||p,j);}return this;},};var g={on:function(j,i,k){this.$el.on(j,i,k);},initialize:function(){this.$el=$("#main-menu");
this.attachEvents();},select:function(j,i){if(this.$el.find(".selected").hasClass(j)){return false;}if(i){e.trigger("menuSelected",i,j);}this.currentPage=j;
this.$el.find(".selected").removeClass("selected");this.$el.find("."+j).addClass("selected");},attachEvents:function(){e.on("popstate",this.select,this);
this.$el.on("click","a",function(j){var i=$(this).data("page");j.preventDefault();g.select.apply(g,[i,this.href]);});}};var b={initialize:function(){this.$body=$("body");
this.$main=$("#main");this.attachEvents();},attachEvents:function(){var i=this;e.on("menuSelected",this.load,this);e.on("contentLoaded",this._loaded,this);
e.on("popstate",this._pop,this);this.$main.on("click",".post a, .articles a",function(j){j.preventDefault();i.load(this.href);});},load:function(i,j){this.$main.fadeOut("fast",function(){f.show();
a.push(i,j);});},_pop:function(i){this.$main.fadeOut("fast",function(){f.show();a.pop(i);});},_loaded:function(k){var i=$(k),j=i.find("#main"),l=i.filter("title").text();
f.hide();this.$main.html(j.children()).fadeIn("fast");this.$body.removeClass().addClass(j.data("type"));e.trigger("contentAppended");},};var f={$el:$("#spin"),show:function(){this.$el.spin();
},hide:function(){this.$el.spin(false);}};var a={initialize:function(i){this.attachEvents();d.history.replaceState({page:$(".selected").find("a").data("page"),title:document.title},document.title,document.location.href);
},push:function(i,k){var j=this;k=(k||g.currentPage);this._getContent(i,function(l){var m;if(l){e.trigger("contentLoaded",l);m=j._extractTitle(l);j._pushHistory(k,m,i);
}else{d.location.href=i;}});},pop:function(j){var i=this;this._getContent(document.location.pathname,function(k){if(k){e.trigger("contentLoaded",k);}else{d.location.href=href;
}});},updateTitle:function(i){document.title=i;},attachEvents:function(){e.on("popstate",this.pop,this);e.on("titleChanged",this.updateTitle,this);},_extractTitle:function(i){return $(i).filter("title").text();
},_getContent:function(i,j){$.ajax({url:i,dataType:"html"}).done(j).fail(function(){j(null);});},_pushHistory:function(j,k,i){d.history.pushState({page:j,title:k},k,i);
},};var c={initialize:function(){e.on("contentAppended",this.refresh);this.refresh();},refresh:function(){$(".fancybox").fancybox();prettyPrint();},iOSSupport:function(){var i=d.navigator.userAgent,j=i.indexOf("OS ");
if((i.indexOf("iPhone")>-1||i.indexOf("iPad")>-1)&&j>-1){return parseFloat(i.substr(j+3,3).replace("_","."))>=5;}return true;}};$(function(){if(Modernizr.history&&c.iOSSupport()){g.initialize();
b.initialize();a.initialize();c.initialize();}});}).call(this);